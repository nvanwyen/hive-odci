--------------------------------------------------------------------------------
--
-- 2016-04-30, NV - hive.par.sql
--

/*
 Copyright (c) 2016, Metasystems Technologies Inc (MTI), Nicholas Van Wyen
 All rights reserved.
 
 Redistribution and use in source and binary forms, with or without 
 modification, are permitted provided that the following conditions are met:
 
 1. Redistributions of source code must retain the above copyright notice, this
    list of conditions and the following disclaimer.
 
 2. Redistributions in binary form must reproduce the above copyright notice,
    this list of conditions and the following disclaimer in the documentation
    and/or other materials provided with the distribution.
 
 3. Neither the name of the copyright holder nor the names of its contributors
    may be used to endorse or promote products derived from this software
    without specific prior written permission.
 
 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
 FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
 CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/

--
prompt ... running hive.par.sql

--
alter session set current_schema = hive;

--
set serveroutput on

--
declare

    --
    procedure param_( n in varchar2, v in varchar2 ) is
    begin

        --
        dbms_hive.param( n, v );

        --
        if ( n not in ( 'application',
                        'version',
                        'license' ) ) then

            dbms_output.put_line( '* ' || rpad( n, 21, ' ' ) || ': ' || v );

        end if;

    end param_;

begin

    --
    dbms_output.put_line( 'Hive Paraemters' );
    dbms_output.put_line( rpad( '-', 80, '-' ) );

    --
    param_( 'application', 'Hive ODCI' );
    param_( 'version', '%version%' );
    param_( 'license', 'Copyright (c) 2006 - 2016 Nicholas Van Wyen, MTI All rights reserved.'     || chr( 13 )
                    ||                                                                                chr( 13 )
                    || 'Redistribution and use in source and binary forms, with or without'        || chr( 13 )
                    || 'modification, are permitted provided that the following conditions'        || chr( 13 )
                    || 'are met:'                                                                  || chr( 13 )
                    ||                                                                                chr( 13 )
                    || ' 1. Redistributions of source code must retain the above copyright'        || chr( 13 )
                    || '    notice, this list of conditions and the following disclaimer.'         || chr( 13 )
                    || ' 2. Redistributions in binary form must reproduce the above copyright'     || chr( 13 )
                    || '    notice, this list of conditions and the following disclaimer in the '  || chr( 13 )
                    || '    documentation and/or other materials provided with the distribution.'  || chr( 13 )
                    || ' 3. The name of the author may not be used to endorse or promote products' || chr( 13 )
                    || '    derived from this software without specific prior written permission.' || chr( 13 )
                    ||                                                                                chr( 13 )
                    || 'THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR'      || chr( 13 )
                    || 'IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES' || chr( 13 )
                    || 'OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.'   || chr( 13 )
                    || 'IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,'          || chr( 13 )
                    || 'INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT ' || chr( 13 )
                    || 'NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,' || chr( 13 )
                    || 'DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY '    || chr( 13 )
                    || 'THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT'       || chr( 13 )
                    || '(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF'  || chr( 13 )
                    || 'THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.'         || chr( 13 ) );

    --
    param_( 'log_level', '3' );

    --
    param_( 'encrypted_values', 'hive_pass' );

    --
    param_( 'hive_users', 'hive_user, hive_admin' );
    param_( 'hive_admin', 'hive_admin' );

    --
    param_( 'hive_jdbc_driver', 'com.ddtek.jdbc.hive.HiveDriver' );

    --
    param_( 'hive_jdbc_url',   'jdbc:datadirect:hive://hive.mtihq.com:10000' );

    -- URL paraemters, each represents a ";" delineated option
    param_( 'hive_jdbc_url.1', 'AuthenticationMethod=userIdPassword' );
    param_( 'hive_jdbc_url.2', 'User=oracle' );
    param_( 'hive_jdbc_url.3', 'Password=welcome1' );
    param_( 'hive_jdbc_url.4', 'url_extra=SpyAttributes=(log=(file)/tmp/ddtek.log;timestamp=yes)' );

    -- URL paraemters are processed in the order 1 .. X, consecutively
    -- until a value cannot be found. For example 1, 2, 3, 5, 6, ...
    --                                                  ^
    --                                                  stops reading here

    -- extra, debugging (ddtek)
    -- param_( 'hive_jdbc_url.4', 'SpyAttributes=(log=(file)/tmp/ddtek.log;timestamp=yes)' );

    -- connection parameters, use NULL to ignore
    param_( 'hive_user', null );
    param_( 'hive_pass', null );
    param_( 'hive_auth', 'normal' );    -- type can be 'normal', 'kerberos', ...
                                        -- use "kerberos", for pre-authentication
                                        -- of session before loading driver

    -- Java system properties (e.g. System.setProperty( name, value ) )
    param_( 'java_property.1', 'java.security.krb5.realm=MTI.COM' );
    param_( 'java_property.2', 'java.security.krb5.realm=kdc.mti.com' );
    param_( 'java_property.3', 'java.security.krb5.conf=/etc/krb5.conf' );
    param_( 'java_property.4', 'java.security.auth.login.index=Client' );
    param_( 'java_property.5', 'java.security.auth.login.config=/etc/jdbc.conf' );

    -- when 'true" enable java output ... SQL> exec dbms_java.set_output( 1000000 );
    param_( 'java_property.6', 'sun.security.krb5.debug=true' );

    -- Java system properties are processed in the order 1 .. X, consecutively
    -- until a value cannot be found. For example 1, 2, 3, 4, 5, 6, 10, 11 ...
    --                                                           ^
    --                                          stops reading here

    -- some Java propertiers require dbms_java permissions to be granted ahead of time
    -- so the use of SQL> exec dbms_java.grant_permission( 'HIVE', 'SYS:<property>', '...', '...' );
    -- may be needed before the property can be used (see hive.prm.sql for examples).

    -- default bind access (upon creation) can be "public", schema, role or "%user%", ...
    -- each comma delineated item is access seperated as by a colon e.g. <account>:<access>
    -- if no access is provided (e.g. no colon) then priv_read is given
    param_( 'default_bind_access', 'public:1, %user%:3' );

    --
    param_( 'query_limit', 1000 );

end;
/

--
-- ... done!
--
